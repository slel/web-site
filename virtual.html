<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="icon" href="logo/favicon.ico" type="image/vnd.microsoft.icon">
<title>0install: Virtual machines</title>
</head>
<body><table>
<tr>
<td class="logo"><a href="/"><img src="logo/zeroinstall-icon.png" width="96" height="95" alt="logo"></a></td>
<td class="header">
<form id="searchbox_010445122533180311286:4ee7gv0f1pc" action="http://google.com/cse" style="float: right; padding-right: 1em;"><p><input type="hidden" name="cx" value="010445122533180311286:4ee7gv0f1pc"><input name="q" type="search" size="14"><input type="submit" name="sa" value="Search"><input type="hidden" name="cof" value="FORID:0"></p></form>
<h1><a href="/">Zero Install</a></h1>
<p class="tagline">the antidote to app-stores</p>
</td>
</tr>
<tr>
<td class="sidebar"><ul class="pages">
<li class="open">
<a href=".">Overview 
      </a><ul>
<li class="closed"><a href="why.html">About 0install 
      </a></li>
<li class="open">
<a href="features.html">Features 
      </a><ul>
<li class="leaf"><a href="distribution-integration.html">Distro integration 
      </a></li>
<li class="open">
<a href="sharing.html">Sharing 
      </a><ul><li class="leaf"><a href="virtual.html" class="selected">Virtual machines 
      </a></li></ul>
</li>
<li class="leaf"><a href="injector-security.html">Security 
      </a></li>
</ul>
</li>
</ul>
</li>
<li class="open">
<a href="news.html">News 
      </a><ul>
<li class="leaf"><a href="0install-2.0.html">0install 2.0 
      </a></li>
<li class="leaf"><a href="roadmap.html">Roadmap 
      </a></li>
</ul>
</li>
<li class="open">
<a href="injector.html">Download 0install 
      </a><ul>
<li class="leaf"><a href="install-linux.html">Linux 
      </a></li>
<li class="closed"><a href="install-osx.html">OS X 
      </a></li>
<li class="closed"><a href="install-source.html">Source code 
      </a></li>
<li class="leaf"><a href="install-unix.html">Unix 
      </a></li>
<li class="leaf"><a href="install-windows.html">Windows 
      </a></li>
</ul>
</li>
<li class="leaf"><a href="injector-feeds.html">Featured apps 
      </a></li>
<li class="open">
<a href="doc.html">Documentation 
      </a><ul>
<li class="closed"><a href="users.html">For users 
      </a></li>
<li class="closed"><a href="packagers.html">For packagers 
      </a></li>
<li class="closed"><a href="dev.html">For developers 
      </a></li>
<li class="closed"><a href="tools.html">Tool reference 
      </a></li>
<li class="closed"><a href="injector-specs.html">Specifications 
      </a></li>
</ul>
</li>
<li class="open">
<a href="support.html">Support 
      </a><ul>
<li class="leaf"><a href="support.html#lists">Mailing lists 
      </a></li>
<li class="leaf"><a href="support.html#bugs">Bug tracker 
      </a></li>
<li class="leaf"><a href="faq.html">FAQ 
      </a></li>
<li class="leaf"><a href="injector-trouble.html">Troubleshooting 
      </a></li>
<li class="leaf"><a href="support.html#commercial">Commercial 
      </a></li>
</ul>
</li>
<li class="leaf"><a href="legal.html">Legal issues 
      </a></li>
<li class="leaf"><a href="https://github.com/0install">GitHub 
      </a></li>
<li class="leaf"><a href="http://sourceforge.net/project/showfiles.php?group_id=76468">SF file releases 
      </a></li>
</ul></td>
<td class="main">
<div class="main">

<h2 id="idm28475866762336">Virtual Machines</h2>

<p>
As well as allowing sharing between users, you can also use Zero Install to share
packages between virtual machines. That is, the package is downloaded and stored once,
but all virtual machines can run it.
</p>

<ol class="toc">
<li><a href="#virtualbox">VirtualBox</a></li>
<li><a href="#vagrant">Vagrant</a></li>
</ol>

<h2 id="virtualbox">VirtualBox</h2>

<p>
<a href="http://www.virtualbox.org/">VirtualBox</a> is a popular free (GPL) virtualisation system. To share your
host's cache with a guest:
</p>

<ul>
 <li>Create a new guest and install an operating system as usual. The guest OS does not need to be the same as the host OS.</li>
 <li>Install the guest tools (choose <b>Install Guest Additions...</b> from the <b>Devices</b> menu).</li>
 <li>Add a shared folder. <b>Folder Path</b> is your implementation cache on the host. This will be <b>/var/cache/0install.net/implementations</b>
 if you have <a href="sharing.html">sharing</a> enabled, or <b>~/.cache/0install.net/implementations</b> if not. <b>Folder Name</b> can be
 anything, e.g. <b>ZeroInstall</b>.</li>
 <li>In the guest, mount the new file-system under <b>/var/cache/0install.net/implementations</b> (regardless of where it is on the host):
 <pre>sudo mount -t vboxsf ZeroInstall /var/cache/0install.net/implementations</pre>
</li>
</ul>

<p>
Notes:
</p>

<ol>
<li><p>If you used the host's /var/cache directory then the guest won't be able to write to the host's cache, which is good for security. Anything installed by the guest will be available only on that guest.
If you want to configure sharing between guest users, however, you'll need to configure a second shared directory, one for guest-wide packages and one for host packages (<b>man 0store</b> for details).</p></li>

<li><p>If you shared the ~/.cache directory, then root in the guest will be able to write to the host cache, which is good for sharing but not so good for security. If you also configure
<a href="sharing.html">sharing</a> in the guest, then guest users can install to the host's cache. Here, you are trusting the guest OS to check the digests correctly.</p></li>

<li><p>It is also possible (though more difficult) to set things up so that an untrusted guest OS can put things in the host's cache (verified by the host).
For this, you will need to make your own version of the <b>0store-secure-add-helper</b> script
that passes the directory to the host for verification.</p></li>

<li><p>Because Zero Install packages are named by their digest, there are no problems with sharing a single cache between different architectures (whether virtual machines or physical machines with a network
file-system). Packages that can be shared will be shared automatically, packages that can't will co-exist peacefully.</p></li>
</ol>

<p>
  Warning: Older versions of the VirtualBox guest additions have problems with symlinks in shared folders. If you allow guests to write to a shared cache on the host, you may get the error "<b>Incorrect manifest -- archive is corrupted</b>", even though the archive is actually OK. Guest additions 4.0.4 is known to not work. Version 4.2.0 seems fine.
</p>

<h2 id="vagrant">Vagrant</h2>

<p><a href="http://www.vagrantup.com/">Vagrant</a> is a tool for managing virtual development environments using VirtualBox.</p>

<p>In your Vagrantfile, use something like this:</p>

<pre>
Vagrant::Config.run do |config|
  [...]
  config.vm.share_folder "host-cache",
			 "/var/cache/0install.net/implementations",
			 "/var/cache/0install.net/implementations"

  # This next bit is convenient but less secure...

  config.vm.customize ["setextradata", :id,
  	"VBoxInternal2/SharedFoldersEnableSymlinksCreate/shared-guest-cache", "1"]
  config.vm.share_folder "shared-guest-cache",
  	"/home/vagrant/.cache/0install.net/implementations",
  	"/home/me/.cache/shared-vagrant-guest-cache"
end
</pre>

<p>or, for later versions:</p>

<pre>
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  [...]
  config.vm.synced_folder "/var/cache/0install.net/implementations",
			  "/var/cache/0install.net/implementations"

  # This next bit is convenient but less secure...

  config.vm.provider :virtualbox do |vb|
    vb.customize ["setextradata", :id,
	  "VBoxInternal2/SharedFoldersEnableSymlinksCreate/shared-guest-cache", "1"]
  end

  config.vm.synced_folder "/home/me/.cache/shared-vagrant-guest-cache",
			  "/home/vagrant/.cache/0install.net/implementations"
end
</pre>

<p>
  Change the "/home/me/.cache/shared-vagrant-guest-cache" line to the path where you want to store the shared cache on the host.
  Ensure you have version 4.2.0 or later of the guest additions installed, or symlinks might not work.
</p>

<p>
Here, the VMs will have read-only access to the host's cache (assuming you've set up <a href="sharing.html">sharing</a> on the host), plus read-write access to a cache shared between the guests. Note that a malicious guest can corrupt this cache, and thus affect other VMs using it. However, assuming non-malicious guests, there is no problem sharing the cache between different VM types (e.g. Debian, Fedora, 32-bit, 64-bit, etc).
</p>

</div>
<div class="footer">
<p>
	    Web-site © Copyright 2003-2015 Thomas Leonard and others<br></p>
<p>
	    Permission is granted to use the site (excluding the software,
	    which is licensed separately)<br>in accordance with the terms of the
	    <a href="http://creativecommons.org/licenses/by-sa/2.5/">Creative
	    Commons Attribution-ShareAlike 2.5 license</a>.
	  </p>
<p>
	    Some of the icons are from (or based on icons from) the
	    <a href="http://tango.freedesktop.org/Tango_Desktop_Project">Tango Desktop Project</a> and the <a href="http://www.openclipart.org/">Open Clipart Library</a>.
	  </p>
<span class="logos"><a href="http://creativecommons.org/licenses/by-sa/2.5/"><img src="http://creativecommons.org/images/public/somerights20.gif" alt="Attribution-ShareAlike" width="88" height="31"></a></span>
</div>
</td>
</tr>
</table></body>
</html>
