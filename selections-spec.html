<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="icon" href="logo/favicon.ico" type="image/vnd.microsoft.icon">
<title>0install: Selections files</title>
</head>
<body><table>
<tr>
<td class="logo"><a href="/"><img src="logo/zeroinstall-icon.png" width="96" height="95" alt="logo"></a></td>
<td class="header">
<form id="searchbox_010445122533180311286:4ee7gv0f1pc" action="http://google.com/cse" style="float: right; padding-right: 1em;"><p><input type="hidden" name="cx" value="010445122533180311286:4ee7gv0f1pc"><input name="q" type="search" size="14"><input type="submit" name="sa" value="Search"><input type="hidden" name="cof" value="FORID:0"></p></form>
<h1><a href="/">Zero Install</a></h1>
<p class="tagline">the antidote to app-stores</p>
</td>
</tr>
<tr>
<td class="sidebar"><ul class="pages">
<li class="open">
<a href=".">Overview 
      </a><ul>
<li class="closed"><a href="why.html">About 0install 
      </a></li>
<li class="closed"><a href="features.html">Features 
      </a></li>
</ul>
</li>
<li class="open">
<a href="news.html">News 
      </a><ul>
<li class="leaf"><a href="0install-2.0.html">0install 2.0 
      </a></li>
<li class="leaf"><a href="roadmap.html">Roadmap 
      </a></li>
</ul>
</li>
<li class="open">
<a href="injector.html">Download 0install 
      </a><ul>
<li class="leaf"><a href="install-linux.html">Linux 
      </a></li>
<li class="closed"><a href="install-osx.html">OS X 
      </a></li>
<li class="closed"><a href="install-source.html">Source code 
      </a></li>
<li class="leaf"><a href="install-unix.html">Unix 
      </a></li>
<li class="leaf"><a href="install-windows.html">Windows 
      </a></li>
</ul>
</li>
<li class="leaf"><a href="injector-feeds.html">Featured apps 
      </a></li>
<li class="open">
<a href="doc.html">Documentation 
      </a><ul>
<li class="closed"><a href="users.html">For users 
      </a></li>
<li class="closed"><a href="packagers.html">For packagers 
      </a></li>
<li class="closed"><a href="dev.html">For developers 
      </a></li>
<li class="closed"><a href="tools.html">Tool reference 
      </a></li>
<li class="open">
<a href="injector-specs.html">Specifications 
      </a><ul>
<li class="leaf"><a href="interface-spec.html">Feed files 
      </a></li>
<li class="leaf"><a href="selections-spec.html" class="selected">Selections files 
      </a></li>
<li class="leaf"><a href="manifest-spec.html">Manifests 
      </a></li>
</ul>
</li>
</ul>
</li>
<li class="open">
<a href="support.html">Support 
      </a><ul>
<li class="leaf"><a href="support.html#lists">Mailing lists 
      </a></li>
<li class="leaf"><a href="support.html#bugs">Bug tracker 
      </a></li>
<li class="leaf"><a href="faq.html">FAQ 
      </a></li>
<li class="leaf"><a href="injector-trouble.html">Troubleshooting 
      </a></li>
<li class="leaf"><a href="support.html#commercial">Commercial 
      </a></li>
</ul>
</li>
<li class="leaf"><a href="legal.html">Legal issues 
      </a></li>
<li class="leaf"><a href="https://github.com/0install">GitHub 
      </a></li>
<li class="leaf"><a href="http://sourceforge.net/project/showfiles.php?group_id=76468">SF file releases 
      </a></li>
</ul></td>
<td class="main">
<div class="main">

<h2 id="idm36555339926624">Selections file format specification</h2>

<p>
  This document describes the format of 0install's XML selections documents. A selections document contains all the information needed
  to launch a program. 0install generates a selections document by collecting information from multiple <a href="interface-spec.html">feeds</a>
  and then running a <a href="solver.html">solver</a> to choose the best combination of components.
</p>

<p>
  For example, to generate the selections document for the ROX Edit application:
</p>

<pre>
  $ 0install select --xml http://rox.sourceforge.net/2005/interfaces/Edit
</pre>

<p>
  For an <a href="user-guide-apps.html">app</a>, <i>foo</i>, the current selections can be found in <b>~/.config/0install.net/apps/foo/selections.xml</b>. For binaries generated by <a href="0compile.html">0compile</a>, the selections used to build it can be found in the <b>0install</b> directory of the binary package, in the <b>build-environment.xml</b> file.
</p>

<p>
  Changes to this document (and to the rest of the web-site) are <a href="https://sourceforge.net/p/zero-install/code/commit_browser">tracked using Git</a>.
</p>

<h2 id="idm36555339918592">Contents</h2>
<ol class="toc">
<li><a href="#intro">&lt;selections&gt;</a></li>
<li><a href="#idm36555339909584">&lt;selection&gt;</a></li>
<li><a href="#idm36555339893952">Executing the selections</a></li>
<li><a href="#idm36555339874960">Future plans</a></li>
</ol>

<h2 id="intro">&lt;selections&gt;</h2>

<p>
  A selections document contains a set of selections, one per selected interface.
</p>

<pre>
&lt;?xml version="1.0" ?&gt;
&lt;selections
    xmlns="http://zero-install.sourceforge.net/2004/injector/interface"
    interface="..."
    command="..." ?
    source="true|false" ? &gt;

  [ selection ] +
&lt;/selections&gt;
</pre>

<dl>
  <dt id="idm36555339915360">interface</dt>
  <dd>The URI of the main program being run (e.g. "http://rox.sourceforge.net/2005/interfaces/Edit").</dd>

  <dt id="idm36555339914480">command</dt>
  <dd>The name of the (optional) &lt;command&gt; to run on the main program (e.g. "run").</dd>

  <dt id="idm36555339913504">source</dt>
  <dd>Indicates whether the root is source or binary (since 0install 2.8). This is useful if implementations of both are present.</dd>
</dl>

<h3 id="idm36555339912464">Historical notes</h3>

<p>
  Before 0install 1.2, there was no <b>command</b> attribute on the root. Instead, the root &lt;selections&gt; element
  also contained a set of &lt;command&gt; elements as direct children. The first &lt;command&gt; was for the main interface,
  the second was for its &lt;runner&gt; and so on. In later versions, the commands go inside their &lt;selection&gt; elements,
  which is needed to support executable bindings.
</p>

<p>
  Before 0install 0.51, there were no commands at all. Instead, the &lt;selection&gt; for the main interface had a <b>main</b>
  attribute which was used (the command should be treated as "run" in this case).
</p>

<h2 id="idm36555339909584">&lt;selection&gt;</h2>

<pre>
&lt;selection
      interface="..."
      from-feed="..." ?
      local-path="..." ?
      quick-test-file="..." ?
      requires-compilation="true" ?
      ... &gt;
    [ dependencies ]
    [ bindings ]
    [ digests ]
    [ commands ]
&lt;/selection&gt;
</pre>

<dl>
  <dt id="idm36555339908048">interface</dt>
  <dd>Indicates that this is the selected implementation of this interface.</dd>

  <dt id="idm36555339907168">from-feed</dt>
  <dd>The URL of the feed which provided this implementation. If missing, use the value of <b>interface</b>.</dd>

  <dt id="idm36555339905808">local-path</dt>
  <dd>For <a href="local-feeds.html">local implementations</a>, this is the path of the directory containing the implementation.</dd>

  <dt id="idm36555339904208">quick-test-file</dt>
  <dd>A file which, if present, indicates that the selection is still valid. This is sometimes used with distribution-provided selections. If not present and the ID starts with "package:", you'll need to query the distribution's package manager to check that this version is still installed.</dd>

  <dt id="idm36555339903104">requires-compilation</dt>
  <dd>
    If present, this attribute indicates that the selection does not yet exist, but could be compiled from the source implementation with the same <b>id</b>. Such selections can be generated when using <b>0install select --may-compile</b> (0install &gt;= 2.9).
  </dd>

  <dt id="idm36555339901232">Other attributes</dt>
  <dd>All attributes from the selected &lt;implementation&gt; are included on the &lt;selection&gt;, except for <b>stability</b> and
    the deprecated <b>main</b> and <b>self-test</b> attributes, which were replaced by commands. The most useful ones are <b>id</b> and <b>version</b>.</dd>
</dl>

<p>
  The <b>dependencies</b>, <b>bindings</b>, <b>digests</b> and <b>commands</b> are defined in the <a href="interface-spec.html">feed
    specification</a>. &lt;restricts&gt; elements are not included.
</p>

<p>
  As in feed files, the <b>id</b> may also be used as a digest or a local path in older documents. See the feed specification for details.
</p>

<h2 id="idm36555339893952">Executing the selections</h2>

<p>
  0install performs the following steps when running an app:
</p>

<ol>
  <li>Load the saved selections XML (or do an update if missing).</li>
  <li>Check that they are valid and up-to-date.</li>
  <li>Process all the bindings to set up the new environment.</li>
  <li>Build the command line arguments, starting with the main command and following the chain of &lt;runner&gt;s.</li>
  <li>Exec the new process.</li>
</ol>

<h3 id="idm36555339890304">Checking the selections are up-to-date</h3>

<p>
  This is how 0install checks the selections for an app before running them:
</p>

<ol>
  <li>
<p>If any input files have changed or disappeared since the solver last ran, we re-run the solver. The files checked are:</p>
    <ul>
      <li>The previously selected feed files (local or cached).</li>
      <li>Configuration files for the selected interfaces (e.g. preferred stability).</li>
      <li>The global configuration file (e.g. preferred stability).</li>
    </ul>
    <p>0install currently ignores feeds and interfaces which were considered but not selected.</p>
  </li>

  <li><p>If any selections are no longer present, we rerun the solver. For distribution packages, we check that the version hasn't changed.</p></li>

  <li><p>If it has been a while since we checked for updates, we trigger a background update but run the current selections anyway.</p></li>
</ol>

<h3 id="idm36555339884576">Processing bindings</h3>

<p>
  For each &lt;selection&gt;, 0install will:
</p>

<ol>
  <li>Process all bindings directly inside the &lt;selection&gt;.</li>
  <li>Process all dependencies directly inside the &lt;selection&gt;:
    <ol>
      <li>Find the selection for the required interface (note: may be missing for non-essential dependencies).</li>
      <li>Process all bindings inside the dependency.</li>
    </ol>
  </li>
  <li>Process all commands directly inside the &lt;selection&gt;:
    <ol>
      <li>Process all bindings inside the command.</li>
      <li>Process all dependencies inside the command, including their bindings (as above) and also including any &lt;runner&gt;.</li>
    </ol>
  </li>
</ol>

<p>
  Having located all the bindings:
</p>

<ol>
  <li>Calculate the environment for the new process by expanding all &lt;environment&gt; bindings.</li>
  <li>Process all &lt;executable-in-var&gt; and &lt;executable-in-path&gt; bindings. Note: you must do this after expanding all other
    environment variables because of $-expansion in &lt;arg&gt;.</li>
</ol>

<p>
  A binding directly inside a &lt;selection&gt; or &lt;command&gt; binds a selection to itself (e.g. a Python library may wish to add itself to PYTHONPATH). Bindings inside dependencies bind to the dependency (e.g. a Python program may wish to add a library to PYTHONPATH).
</p>

<p>
  A distribution-provided selection does not have a path, and so any &lt;environment&gt; bindings for it are skipped (e.g. it's up to the
  distribution package manager to ensure that Python libraries it provides are in the default search path).
</p>

<h2 id="idm36555339874960">Future plans</h2>

<p>
  Indexing the selections by interface URI is a bit restrictive. Once we get scoping, we'll need to cope with e.g. a Python 2 program
  that depends on a Python 3 program, which will require two different selections for the Python interface.
</p>

</div>
<div class="footer">
<p>
	    Web-site © Copyright 2003-2015 Thomas Leonard and others<br></p>
<p>
	    Permission is granted to use the site (excluding the software,
	    which is licensed separately)<br>in accordance with the terms of the
	    <a href="http://creativecommons.org/licenses/by-sa/2.5/">Creative
	    Commons Attribution-ShareAlike 2.5 license</a>.
	  </p>
<p>
	    Some of the icons are from (or based on icons from) the
	    <a href="http://tango.freedesktop.org/Tango_Desktop_Project">Tango Desktop Project</a> and the <a href="http://www.openclipart.org/">Open Clipart Library</a>.
	  </p>
<span class="logos"><a href="http://creativecommons.org/licenses/by-sa/2.5/"><img src="http://creativecommons.org/images/public/somerights20.gif" alt="Attribution-ShareAlike" width="88" height="31"></a></span>
</div>
</td>
</tr>
</table></body>
</html>
