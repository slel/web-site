<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="icon" href="logo/favicon.ico" type="image/vnd.microsoft.icon">
<title>0install: Make-headers</title>
</head>
<body><table>
<tr>
<td class="logo"><a href="/"><img src="logo/zeroinstall-icon.png" width="96" height="95" alt="logo"></a></td>
<td class="header">
<form id="searchbox_010445122533180311286:4ee7gv0f1pc" action="http://google.com/cse" style="float: right; padding-right: 1em;"><p><input type="hidden" name="cx" value="010445122533180311286:4ee7gv0f1pc"><input name="q" type="search" size="14"><input type="submit" name="sa" value="Search"><input type="hidden" name="cof" value="FORID:0"></p></form>
<h1><a href="/">Zero Install</a></h1>
<p class="tagline">the antidote to app-stores</p>
</td>
</tr>
<tr>
<td class="sidebar"><ul class="pages">
<li class="open">
<a href=".">Overview 
      </a><ul>
<li class="closed"><a href="why.html">About 0install 
      </a></li>
<li class="closed"><a href="features.html">Features 
      </a></li>
</ul>
</li>
<li class="open">
<a href="news.html">News 
      </a><ul>
<li class="leaf"><a href="0install-2.0.html">0install 2.0 
      </a></li>
<li class="leaf"><a href="roadmap.html">Roadmap 
      </a></li>
</ul>
</li>
<li class="open">
<a href="injector.html">Download 0install 
      </a><ul>
<li class="leaf"><a href="install-linux.html">Linux 
      </a></li>
<li class="closed"><a href="install-osx.html">OS X 
      </a></li>
<li class="closed"><a href="install-source.html">Source code 
      </a></li>
<li class="leaf"><a href="install-unix.html">Unix 
      </a></li>
<li class="leaf"><a href="install-windows.html">Windows 
      </a></li>
</ul>
</li>
<li class="leaf"><a href="injector-feeds.html">Featured apps 
      </a></li>
<li class="open">
<a href="doc.html">Documentation 
      </a><ul>
<li class="closed"><a href="users.html">For users 
      </a></li>
<li class="closed"><a href="packagers.html">For packagers 
      </a></li>
<li class="closed"><a href="dev.html">For developers 
      </a></li>
<li class="open">
<a href="tools.html">Tool reference 
      </a><ul>
<li class="leaf"><a href="0bootstrap.html">0bootstrap 
      </a></li>
<li class="closed"><a href="0compile.html">0compile 
      </a></li>
<li class="leaf"><a href="ebox.html">ebox 
      </a></li>
<li class="leaf"><a href="0export.html">0export 
      </a></li>
<li class="leaf"><a href="feedlint.html">FeedLint 
      </a></li>
<li class="leaf"><a href="make-headers.html" class="selected">Make-headers 
      </a></li>
<li class="leaf"><a href="0mirror.html">0mirror 
      </a></li>
<li class="leaf"><a href="pkg2zero.html">pkg2zero 
      </a></li>
<li class="leaf"><a href="0publish.html">0publish 
      </a></li>
<li class="closed"><a href="0release.html">0release 
      </a></li>
<li class="leaf"><a href="0share.html">0share 
      </a></li>
<li class="leaf"><a href="0template.html">0template 
      </a></li>
<li class="leaf"><a href="0repo.html">0repo 
      </a></li>
<li class="leaf"><a href="0test.html">0test 
      </a></li>
</ul>
</li>
<li class="closed"><a href="injector-specs.html">Specifications 
      </a></li>
</ul>
</li>
<li class="open">
<a href="support.html">Support 
      </a><ul>
<li class="leaf"><a href="support.html#lists">Mailing lists 
      </a></li>
<li class="leaf"><a href="support.html#bugs">Bug tracker 
      </a></li>
<li class="leaf"><a href="faq.html">FAQ 
      </a></li>
<li class="leaf"><a href="injector-trouble.html">Troubleshooting 
      </a></li>
<li class="leaf"><a href="support.html#commercial">Commercial 
      </a></li>
</ul>
</li>
<li class="leaf"><a href="legal.html">Legal issues 
      </a></li>
<li class="leaf"><a href="https://github.com/0install">GitHub 
      </a></li>
<li class="leaf"><a href="http://sourceforge.net/project/showfiles.php?group_id=76468">SF file releases 
      </a></li>
</ul></td>
<td class="main">
<div class="main">

<table><tr>
<td style="vertical-align: top">
<h2>Make-headers</h2>

<p>
<b>Make-headers</b> is an extremely simple script for creating -dev packages (packages containing only header files) from
ordinary source releases. It performs the following steps:
</p>

<ol>
 <li>Runs <b>$SRCDIR/configure --prefix $DESTDIR &amp;&amp; make install</b>
</li>
 <li>Notes the version numbers in any lib*.so symlinks (see below)</li>
 <li>Deletes <b>$DESTDIR/{bin,man,share}</b>, any library binaries (<b>.so</b>, <b>.a</b> and <b>.la</b> files in <b>lib</b>), and any <b>lib/python*</b> directories.</li>
 <li>Edits any pkg-config files (<b>lib/pkgconfig/*.pc</b>) to use a relative prefix of <b>${pcfiledir}/../..</b>.</li>
</ol>
</td>
<td style="vertical-align: top"><div class="program"><table>
<tr>
<th>Name</th>
<td>Make-headers</td>
</tr>
<tr>
<th>Maintainer</th>
<td>Thomas Leonard</td>
</tr>
<tr>
<th>License</th>
<td>GNU General Public License</td>
</tr>
<tr>
<th>Run it</th>
<td><a href="http://0install.net/2007/interfaces/Make-headers.xml">Zero Install feed</a></td>
</tr>
<tr>
<th>SCM</th>
<td><a href="http://repo.or.cz/w/make-headers.git">GIT repository</a></td>
</tr>
</table></div></td>
</tr></table>

<p>
In other words, it does a full compile-and-install to $DESTDIR, deletes anything that isn't needed in a -dev package, and makes the result relocatable.
It can be used as the compile command in a source implementation. For example, <a href="http://0install.net/2006/interfaces/GLib-dev">the GLib-dev feed</a>
contains this entry:
</p>

<pre>
  &lt;group <b>arch="*-src" compile:command='"$BUILD_COMMAND"'</b>&gt;
    &lt;implementation id="sha1new=fd1cf4afd14067866e626a2c91f9839f4639e604"
                    released="2007-03-04" stability="stable"
		    version="2.4.8"&gt;
      &lt;archive extract="glib-2.4.8"
               href="ftp://ftp.gtk.org/pub/gtk/v2.4/glib-2.4.8.tar.bz2"
	       size="2152755"
	       type="application/x-bzip-compressed-tar"/&gt;
    &lt;/implementation&gt;
    &lt;requires interface="<b>http://0install.net/2007/interfaces/Make-headers.xml</b>"&gt;
      <b>&lt;environment insert="make-headers.py" name="BUILD_COMMAND"/&gt;</b>
    &lt;/requires&gt;
</pre>

<p>
This allows <a href="0compile.html">0compile</a> to create the GLib-dev package from the upstream source automatically.
</p>

<p>
Note: If your package creates script files in <b>bin</b> that are part of the -dev package (i.e. they are used when building
programs that use the library) then use <b>--keep=bin</b> to prevent them from being deleted.
</p>

<h2 id="idm27812398354752">Major version mappings</h2>

<p>
There is a particular issue that comes up if you want to provide the header files (*.h)
through Zero Install, but have the user get the run-time files (*.so) through their
distribution. First, some background:
</p>

<h3 id="idm27812398353760">Library versioning on Linux/Unix systems</h3>

<p>
The obvious way to store a shared library object in a package is to give it a
simple name like <b>libfoo.so</b>. The packaging system selects which version
of this file to use and the program loads it. Easy. This is how a pure Zero Install
system would work.
</p>

<p>
However, in a traditional packaging system (apt, make install, etc), where library
files go in a single directory (e.g. /usr/lib), this would make it impossible to have
two versions of a library installed at once. As a special work-around, shared library
objects include their version number in their name (e.g. <b>libfoo.so.1.2.3</b>).
You (or your package manager) then adds two symlinks:
</p>

<ul>
<li>
<b>libfoo.so</b> is the symlink used when compiling</li>
<li>
<b>libfoo.so.1</b> is the symlink used when running (here "1" is the "major" part of the
version number from our example of "1.2.3")</li>
</ul>

<p>
The idea is that you make sure <b>libfoo.so</b> points to the correct version and then compile
your code. The compiled binary takes the first part of the version number (here "1") and
stores <b>libfoo.so.1</b> as its dependency. When run, it uses the second symlink to find the
actual library version. Minor (compatible) upgrades to the library have the same major version.
For example, after installing a minor update the symlinks will point to <b>libfoo.so.1.3.0</b>,
still with major version "1".
</p>

<p>
For major (incompatible) changes, the major version number is changed. After installing a major
upgrade (2.0.0), you have three symlinks:
</p>

<ul>
<li>
<b>libfoo.so.1</b> to <b>libfoo.1.2.3</b> (from the previous version)</li>
<li>
<b>libfoo.so.2</b> to <b>libfoo.2.0.0</b>
</li>
<li>
<b>libfoo.so</b> to <b>libfoo.2.0.0</b>
</li>
</ul>

<p>
Programs that need version 1 of the library can no longer be compiled (they try to use <b>libfoo.so</b> and fail),
but any existing binaries will still run (they try to use <b>libfoo.so.1</b> and succeed).
This is pretty horrible, but it's the way it works. The real problem is that the
source code doesn't say what major version of the library it needs; it just fails to compile if you
get it wrong, and you can only have the ability to compile against one version at a time.
</p>

<p>
Obviously, this scheme doesn't work in Zero Install, since installing a package is always
side-effect-free. Preventing old programs from compiling would clearly be a side-effect.
</p>

<p>
In a pure Zero Install system, you can always use the simple scheme above and
everything works correctly. In fact, to avoid changing existing libraries, we
usually do include the version number in the library name, and we include both
symlinks in the runtime package. This doesn't do any harm, because Zero Install keeps
files from different packages in different places.
</p>

<h3 id="idm27812398339872">Using Zero Install -dev packages with distribution runtime packages</h3>

<p>
However, what if you want to combine both systems? That is, what if you want to get the
header files through Zero Install but get the runtime shared object through your distribution's
packaging system? Then there is a small problem. In Zero Install, we have:
</p>

<ul>
<li>A library package contains the libfoo.so and libfoo.so.version files.</li>
<li>A -dev package contains the header files.</li>
</ul>

<p>In a distribution package:</p>
<ul>
<li>A library package contains the libfoo.so.version file only.</li>
<li>A -dev package contains headers and the libfoo.so file (only one -dev package can be installed at once).</li>
</ul>

<p>
So, if you tried to use a Zero Install -dev package with a distribution library
package, no one provides the libfoo.so file and the link fails.
</p>

<p>
To fix this, a Zero Install -dev package can specify the mappings from library names
to major version numbers, like this:
</p>

<pre>
&lt;interface uri='.../libfoo-dev'&gt;
  ...
  &lt;implementation compile:lib-mappings="foo:1" ... /&gt;</pre>

<p>
When 0compile compiles anything that depends on this -dev package, it searches
for libfoo.so.1 (provided by the distribution) in the library
search path and creates a symlink to it named libfoo.so in a
temporary directory, which it adds to the search path. Programs should then
compile correctly without modifications. Multiple mappings can be given in the
attribute, separated by spaces.
</p>

<p>
To be clear: a Zero Install source package depends on the library -dev package using
the normal Zero Install mechanism (&lt;requires ...&gt; &lt;version ...&gt;). Having
selected a suitable version of the -dev package, Zero Install uses the mappings inside
it to work out what the compiled binary should link against.
</p>

<p>
The source for a -dev package can use compile:binary-lib-mappings to have this
value placed in the generated -dev "binary" package. However, starting with version
0.3, Make-headers can automatically work out the correct values and add them to the
feed.
</p>

<p>
In summary:
</p>

<ul>
 <li>If you are creating a source package that depends on a library, ignore all this and
 just put in a normal Zero Install dependency. 0compile will handle the mappings for you.</li>
 <li>If you are publishing an existing -dev package for a library that isn't in
 Zero Install, remember add the lib-mappings attribute.</li>
 <li>If you are publishing source for a -dev package, Make-headers should add the correct
 values for you automatically.</li>
</ul>

</div>
<div class="footer">
<p>
	    Web-site © Copyright 2003-2015 Thomas Leonard and others<br></p>
<p>
	    Permission is granted to use the site (excluding the software,
	    which is licensed separately)<br>in accordance with the terms of the
	    <a href="http://creativecommons.org/licenses/by-sa/2.5/">Creative
	    Commons Attribution-ShareAlike 2.5 license</a>.
	  </p>
<p>
	    Some of the icons are from (or based on icons from) the
	    <a href="http://tango.freedesktop.org/Tango_Desktop_Project">Tango Desktop Project</a> and the <a href="http://www.openclipart.org/">Open Clipart Library</a>.
	  </p>
<span class="logos"><a href="http://creativecommons.org/licenses/by-sa/2.5/"><img src="http://creativecommons.org/images/public/somerights20.gif" alt="Attribution-ShareAlike" width="88" height="31"></a></span>
</div>
</td>
</tr>
</table></body>
</html>
